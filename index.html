<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <!-- 테마 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <!-- 자바스크립트 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    
    <link rel="icon" href="static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="static/styles/main.css">
    <title>3D 창고 시뮬레이션</title>

    <style>
      .error-text {
          color: red;
      }
      
    </style>

  </head>

  <body>

  <div id="myGroup" style="position:absolute"> 

      <!-- 사용설명서 모달 -->
      <div class="modal" id="userGuideModal">
          <div class="modal-dialog">
              <div class="modal-content">
  
                <!-- 모달 헤더 -->
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                  <h4 class="modal-title" style="text-align: center; font-weight: bold; font-size: 24px;">사용설명서</h4>
                </div>
  
                <!-- 모달 본문 -->
                <div class="modal-body">
                    <li>가로, 세로, 높이 입력칸은 도면에 그리고자 하는 적재 물품의 가로, 세로, 높이 길이입니다.</li><br>
                    <li>x축의 값이 커질수록 사물이 오른쪽으로 이동합니다.</li><br>
                    <li>y축의 값이 커질수록 사물이 윗쪽으로 이동합니다.</li><br>
                    <li>z축의 값이 커질수록 사물이 사용자 방향으로 가까워집니다.</li><br>
                    <li>마우스 우클릭 시 그림자가 사라지면서 해당 도형이 삭제됩니다.</li><br>
                    <li>더 많은 정보가 궁금하시면 <a href="https://threejs.org" target="_blank">이곳</a>을 방문해주세요.</li>
                </div>
  
                <!-- 모달 푸터 -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                </div>
  
              </div>
          </div>
      </div>


    <!-- 저장 모달 -->
    <div class="modal" id="InfoSaveModal">
        <div class="modal-dialog">
            <div class="modal-content">

              <!-- 모달 헤더 -->
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title" style="text-align: center;">특이사항</h4>
              </div>

              <!-- 모달 본문 -->
              <div class="modal-body">
                  <input type="text" id="title" name="title" placeholder="제목을 입력하세요." autocomplete="off"/><br><br>
                  <textarea rows="4" cols="50" id="bigo" name="bigo" placeholder="내용을 입력하세요." autocomplete="off"></textarea>
              </div>

              <!-- 모달 푸터 -->
              <div class="modal-footer">
                  <button type="button" class="btn btn-success" id="btnModalSave">저장</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
              </div>

            </div>
        </div>
    </div>

  
    <h3 style="text-align: center; display: block;">3D 창고 시뮬레이션</h3>
      <div>
        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#userGuideModal" style="float: left;">사용설명서</button>
        <button id="btnVessel" class="btn btn-light" style="float: right; margin-left: 5px;">선박</button>
        <button id="btnNon" class="btn btn-light" style="float: right;">논</button>
      </div>
    
      <br><br>
        가로 : <input type="text" id="width" name="width" style="text-align: right" placeholder="가로를 입력하세요." autocomplete="off"/><span class="error-text"></span><br>
        세로 : <input type="text" id="height" name="height" style="text-align: right" placeholder="세로를 입력하세요." autocomplete="off"/><span class="error-text"></span><br>
        높이 : <input type="text" id="vertical" name="vertical" style="text-align: right" placeholder="높이를 입력하세요." autocomplete="off"/><span class="error-text"></span><br>
        X축&nbsp; : <input type="text" id="x_chuk" name="x_chuk" style="text-align: right" placeholder="X축 좌표를 입력하세요." autocomplete="off"/><span class="error-text"></span><br>
        Y축&nbsp; : <input type="text" id="y_chuk" name="y_chuk" style="text-align: right" placeholder="y축 좌표를 입력하세요." autocomplete="off"/><span class="error-text"></span><br>
        Z축&nbsp; : <input type="text" id="z_chuk" name="z_chuk" style="text-align: right" placeholder="z축 좌표를 입력하세요." autocomplete="off"/><span class="error-text"></span><br><br>
        <button type="button" class="btn btn-success" id="btnTrans"> 적용 </button>
        <button type="button" class="btn btn-warning" id="btnPrev"> 이전 </button>
        <button type="button" class="btn btn-danger" id="btnReset"> 초기화 </button>
        <button type="button" class="btn btn-primary" id="btnOpenModal" data-toggle="modal" data-target="#InfoSaveModal">저장</button>
        <button type="button" class="btn btn-light" id="btnSearch"> 조회 </button>
      </div>
  </div>
    
    <script src="public/bundle.js"></script>
    <script src="src/index.js"></script>

  </body>

  <script>
    $(document).ready(function() {

      $("#width").focus();

      defaultPage();

  });
        

  // 유효성 검사
  $('input[type="text"]').on('blur', inputValid);

  // 적용 버튼
  $("#btnTrans").click(fnClickTrans);

  // 이전 버튼
  $("#btnPrev").click(fnClickPrev);

  // 초기화 버튼
  $("#btnReset").click(fnClickReset);

  // 모달내부 저장 버튼 (실제 저장)
  $("#btnModalSave").click(fnClickModalSave);

  // 조회 버튼
  $("#btnSearch").click(fnClickSearch);
  
  // 논 버튼
  $("#btnNon").click(fnChangeNon);

  // 선박 버튼
  $("#btnVessel").click(fnChangeVessel);


  function inputValid() {
    const inputVal = $(this).val();
    const errorText = $(this).next('.error-text');

    // 정규식 (숫자 1 ~ 9)
    var onlyNumber = /^[0-9]*$/;
    
    if(!onlyNumber.test(inputVal)){
      errorText.text(' 양의 정수를 입력하세요.');
    }else{
      errorText.text('');
    }
  }

  function fnClickTrans() {

    var width = $("#width").val();
    var height = $("#height").val();
    var vertical = $("#vertical").val();
    var x_chuk = $("#x_chuk").val();
    var y_chuk = $("#y_chuk").val();
    var z_chuk = $("#z_chuk").val();

    var valList = [ width, height, vertical, x_chuk, y_chuk, z_chuk ];

    setTransData(valList);

  }
  
  function fnClickPrev(){
    setPrevData();
  }

  function fnClickReset(){
    setResetData();
  }

  function fnClickModalSave(){

    // 겟요청 코드
    //  $.get('http://localhost:7000/api/data', function(data) {
    //   $('#result').text('백엔드로부터 받은 데이터: ' + data);
    // });

    const dataToSend = {
      title: $("#title").val(),
      bigo: $("#bigo").val(),
      width: $("#width").val(),
      height: $("#height").val(),
      vertical: $("#vertical").val(),
      x_chuk: $("#x_chuk").val(),
      y_chuk: $("#y_chuk").val(),
      z_chuk: $("#z_chuk").val()
    };

    const fieldIds = ["title", "width", "height", "vertical", "x_chuk", "y_chuk", "z_chuk"]; // bigo 는 null 허용

    for (const fieldId of fieldIds) {
      const value = $("#" + fieldId).val();
      if (!value) {
        alert("내용을 제외한 모든 필드를 작성해야 합니다.");
        return false;
      }
    }

    $.ajax({
      type: "POST",
      url: "http://localhost:7000/api/data", // 백엔드 컨트롤러 URL
      data: JSON.stringify(dataToSend),
      contentType: 'application/json',
      success: function(data) {
        console.log("결과는 :" + data)
      }
    }); 

  }

  
  function fnClickSearch(){
    alert("조회서비스 준비중")
  }


  function fnChangeNon(){
    if($("#btnVessel").hasClass("btn btn-success")){
      $("#btnVessel").removeClass("btn btn-success").addClass("btn btn-light")
    }
    $("#btnNon").removeClass("btn btn-light").addClass("btn btn-success")

    init("non")
  }

  function fnChangeVessel(){
    if($("#btnNon").hasClass("btn btn-success")){
      $("#btnNon").removeClass("btn btn-success").addClass("btn btn-light")
    }
    $("#btnVessel").removeClass("btn btn-light").addClass("btn btn-success")

    init("vessel")
  }

 

</script>

</html>
