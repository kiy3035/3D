<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>바코드 스캐너</title>
</head>
<body>
    <!-- 바코드 스캐너 시작 버튼 -->
    <button id="startScannerBtn">바코드 스캐너 시작</button>

<!-- 비디오 피드를 표시할 영역 -->
<div style="cursor: pointer;">
    <video id="scanner-container" width="100%" height="100%" style="object-fit: cover;"></video>
</div>


<!-- JavaScript 코드 -->
<script src="/instascan.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        let scanner = null; // 스캐너 객체 초기화

        // 바코드 스캐너 시작 버튼 클릭 이벤트 핸들러
        document.getElementById('startScannerBtn').addEventListener('click', function () {
            if (scanner === null) {
                // instascan 객체 생성
                scanner = new Instascan.Scanner({
                    video: document.getElementById('scanner-container'),
                });

                // 바코드가 스캔되면 호출될 콜백 함수
                scanner.addListener('scan', function (content) {
                    alert('바코드 스캔 결과: ' + content);
                });

                // 비디오 시작 함수
                Instascan.Camera.getCameras().then(function (cameras) {
                    if (cameras.length > 0) {
        const video = document.getElementById('scanner-container');
        const stream = cameras[0].stream; // 카메라에서 스트림 가져오기
debugger
        // 스트림이 정상적으로 있을 때만 할당
        if (stream) {
            // 비디오에 스트림 할당
            video.srcObject = stream;

            // play 호출
            video.play();
        } else {
            console.error('카메라 스트림이 없습니다.');
        }
     } else {
                        console.error('카메라를 찾을 수 없습니다.');
                    }
                }).catch(function (e) {
                    console.error(e);
                });
            } else {
                alert('바코드 스캐너가 이미 실행 중입니다.');
            }
        });
    });
</script>

</body>
</html>
