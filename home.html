<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
</head>
<body>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>

    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    var renderer = new THREE.WebGLRenderer();

    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // 뒤에 배경
    var textureLoader = new THREE.TextureLoader();
    var homeImg = textureLoader.load('static/backgroundimages/home.jpg')

    scene.background = homeImg;
    renderer.render(scene, camera);
    document.body.appendChild(renderer.domElement);

    // 이미지 텍스처 로드
    var textureLoader = new THREE.TextureLoader();
    var textureList = [
        'static/textures/container4.jpg',
        'static/textures/container2.jpg',
        'static/textures/container3.jpg',
        'static/textures/container1.jpg'
    ];

    // Geometry 생성
    var geometry = new THREE.BoxGeometry(1.5, 1.5, 1.5);

    // Material 및 Mesh 생성
    var cubes = [];

    // 2x2 형태로 배열하기 위한 좌표 배열
    var positions = [
        { x: -2, y: 2 },
        { x: 2, y: 2 },
        { x: -2, y: -2 },
        { x: 2, y: -2 }
    ];

    textureList.forEach(function (texturePath, index) {
        var material = new THREE.MeshLambertMaterial({ map: textureLoader.load(texturePath) });
        var cube = new THREE.Mesh(geometry, material);

        // 초기 위치 설정
        cube.position.set(positions[index].x, positions[index].y, 0);

        scene.add(cube);
        cubes.push(cube);
    });

    // Raycaster 생성
    var raycaster = new THREE.Raycaster();
    var mouse = new THREE.Vector2();

    document.addEventListener('click', onDocumentClick, false);

    const light = new THREE.PointLight(0xffffff, 1);
    light.position.set(10, 10, 10);
    scene.add(light);

    // 카메라 위치 설정
    camera.position.z = 5;

    // 클릭 이벤트 핸들러
    function onDocumentClick(event) {
        event.preventDefault();

        // 마우스 위치 계산
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;

        // Raycaster로 객체 선택
        raycaster.setFromCamera(mouse, camera);

        var intersects = raycaster.intersectObjects(cubes);

        if (intersects.length > 0) {
            var selectedObject = intersects[0].object;
            var objectIndex = cubes.indexOf(selectedObject);
            var selectedContainer = textureList[objectIndex];

            // 클릭한 cube의 src 값을 로컬 스토리지에 저장
            localStorage.setItem('selectedContainer', selectedContainer);

            // 홈으로 이동
            window.location.href = '/';
        }
    }

    function resizeImg() {
        
        // 뷰포트의 크기 변경에 따라 배경 이미지 크기 조절
        var aspect = window.innerWidth / window.innerHeight;
        camera.aspect = aspect;
        camera.updateProjectionMatrix();

        // Three.js 렌더러 크기 업데이트
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    window.addEventListener('resize', resizeImg);

    // 애니메이션 루프
    const animate = () => {
        requestAnimationFrame(animate);

        cubes.forEach(function (cube) {
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
        });

        renderer.render(scene, camera);
    };

    animate();
</script>
   

</html>